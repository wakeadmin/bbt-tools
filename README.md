| ğŸš§ é¡¹ç›®æ­£å¤„äºå¼€å‘ä¸­

# bbt

<center>
  <img src="./logo.png" alt="bbt" />
</center>

---

`bbt` æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„è¯­è¨€åŒ…ç®¡ç†å’Œç¿»è¯‘å·¥å…·ã€‚BBT æ˜¯ `Tower of Babel` å³å·´åˆ«å¡”çš„æ„æ€ï¼Œå·´åˆ«å¡”æ˜¯å‡ºè‡ªã€Šåœ£ç»ã€‹çš„ä¸€åˆ™æ•…äº‹ï¼Œæ•…äº‹å‘ç”Ÿåœ¨æ´ªæ°´ä¹‹åï¼Œäººç±»å¼€å§‹ç¹è¡ç”Ÿæ¯ï¼Œä»–ä»¬å†³å®šå»ºé€ ä¸€åº§é«˜å¡”ï¼Œå¡”é¡¶èƒ½å¤Ÿè§¦åŠå¤©ç©ºï¼Œä»¥æ­¤æ¥å½°æ˜¾è‡ªå·±çš„åŠ›é‡ã€‚ç„¶è€Œï¼Œä¸Šå¸è®¤ä¸ºäººç±»è¿‡äºå‚²æ…¢ï¼Œäºæ˜¯è®©ä»–ä»¬è¯´ä¸åŒçš„è¯­è¨€ï¼Œä½¿ä»–ä»¬æ— æ³•æ²Ÿé€šï¼Œæœ€ç»ˆå¯¼è‡´å»ºå¡”å·¥ç¨‹çš„å¤±è´¥ã€‚

<br>
<br>

---

## å·¥ä½œæµç¨‹å’Œåˆè¡·

ä½œä¸ºä¸­æ–‡å¼€å‘è€…ï¼Œæˆ‘ä»¬æ›´ä¹ æƒ¯åœ¨ä¸­æ–‡ç¯å¢ƒä¸‹ç¼–ç¨‹ï¼Œå¹¶ä¸”ä¹Ÿå°‘æœ‰ç¨‹åºå‘˜èƒ½å¤ŸæŒæ¡å¤šé—¨è¯­è¨€ï¼Œå°¤å…¶æ˜¯æ¯”å¦‚æ—¥è¯­ã€æ³°è¯­ã€æ³•è¯­è¿™ç±»å°è¯­ç§ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬çš„ç¨‹åºä¸»è¦ä»¥ä¸­æ–‡ä¸ºç¬¬ä¸€å…¬æ°‘ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„ç¨‹åºéœ€è¦æ”¯æŒå¤šè¯­è¨€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å°†ä¸­æ–‡çš„å†…å®¹ç¿»è¯‘æˆå…¶ä»–è¯­è¨€ï¼Œè¿™å°±æ˜¯`bbt-tools`çš„åˆè¡·ã€‚

<br>

`bbt`çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š

1. æ”¶é›†æ‰€æœ‰çš„ç¿»è¯‘å†…å®¹
2. å°†ç¿»è¯‘å†…å®¹å¯¼å‡ºåˆ° Excel(excel æ–‡ä»¶æˆ–è€… CSV) è¡¨æ ¼ä¸­
3. å°† excel è¡¨æ ¼å‘é€ç»™ç¿»è¯‘äººå‘˜, æˆ–è€…ç¨‹åºå‘˜é€šè¿‡ç¿»è¯‘å·¥å…·ç¿»è¯‘
4. ç¿»è¯‘äººå‘˜ç¿»è¯‘æˆ–æ ¡å‡†å®Œæˆä¹‹åï¼Œå°† excel è¡¨æ ¼å‘é€ç»™å¼€å‘äººå‘˜
5. å¼€å‘äººå‘˜å°† excel è¡¨æ ¼å¯¼å…¥åˆ°é¡¹ç›®ä¸­
6. å¼€å‘äººå‘˜å°† excel è¡¨æ ¼å›å†™åˆ°è¯­è¨€åŒ…ä¸­

<br>
<br>

## ä½¿ç”¨

### å®‰è£…

```shell
$ npm install @wakeadmin/bbt  // or
$ yarn add @wakeadmin/bbt  // or
$ pnpm add @wakeadmin/bbt

$ npx bbt [command] <options>
```

<br>

### å‘½ä»¤

#### init

åˆå§‹åŒ–ï¼Œå°†ç”Ÿæˆé…ç½®æ–‡ä»¶

```shell
$ npx bbt init
```

<br>

```typescript
  /**
   *  æ”¯æŒçš„è¯­è¨€åˆ—è¡¨
   */
  langs: string[];
  /**
   * ç”Ÿæˆçš„èµ„æºç›®å½•åœ°å€
   *
   * é»˜è®¤ä¸º './'
   */
  resourcePath: string;
  /**
   * æ–‡ä»¶åŒ¹é…æ­£åˆ™
   */
  test: string;
  /**
   *  åœ¨é‚£ä¸ªæ–‡ä»¶å¤¹ä¸‹æ”¶é›†è¯­è¨€ä¿¡æ¯
   *
   *  é»˜è®¤ä¸º `./src`
   */
  src: string;
  /**
   * å¿½ç•¥çš„æ–‡ä»¶å¤¹ ç±»å‹ä¸ºæ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²
   */
  exclude: string[];
  /**
   * excel çš„è¾“å‡ºåœ°å€
   *
   * é»˜è®¤ä¸º `./bbt-lang/bbt.csv`
   */
  bbtExcelPath: string;
  /**
   * å¯¹æ¯”è§„åˆ™
   *
   * é»˜è®¤ä¸º `relaxed`
   *
   * - strict  å¦‚æœåŸºå‡†å€¼ä¸ä¸€è‡´ é‚£ä¹ˆä¿®æ”¹å…¶åŸºå‡†å€¼ å¹¶æ¸…ç©ºå…¶ä»–å€¼
   * - relaxed ç›´æ¥è¿›è¡Œåˆå¹¶æ“ä½œ
   */
  diffMode: DiffModeEnum;
  /**
   * è¾“å‡ºæ–‡ä»¶çš„åç¼€
   *
   * é»˜è®¤ä¸º `tr`
   */
  outFileExtName: string;

  plugins?: {
    /**
     * è‡ªå®šä¹‰æ–‡ä»¶è§£æå™¨
     *
     * åœ¨è¯»å–æ–‡ä»¶æ—¶ è°ƒç”¨`parse`æ–¹æ³•å°†æ–‡ä»¶å†…å®¹è½¬æ¢ä¸º`JSON`å¯¹è±¡
     * åœ¨å†™å…¥æ–‡ä»¶æ—¶ è°ƒç”¨`stringify`æ–¹æ³•å°†`JSON`å¯¹è±¡å†™å…¥åˆ°æ–‡ä»¶ä¸­
     */
    parser?: FileParser;

    /**
     * è‡ªå®šä¹‰ç¿»è¯‘
     * @param record - éœ€è¦ç¿»è¯‘çš„æ•°æ®æº
     * @param target - ç¿»è¯‘çš„ç›®æ ‡è¯­è¨€
     * @param sourceLanguage - æ•°æ®æºåŸæœ¬çš„è¯­è¨€
     * @returns Observable<TranslatedList<string>> | Promise<TranslatedList<string>>;
     */
    translator: (
      record: Record<string, string>,
      target: string,
      sourceLanguage: string
    ) => Observable<TranslatedList<string>> | Promise<TranslatedList<string>>;
  };
```

<br>
<br>

#### collection

æ”¶é›†æ‰€æœ‰çš„ç¬¦åˆè¦æ±‚çš„æ–‡ä»¶

| name     | shortName | type     | description  | default           | required |
| -------- | --------- | -------- | ------------ | ----------------- | -------- |
| --config | -c        | `string` | é…ç½®æ–‡ä»¶åœ°å€ | `./bbt.config.js` | `false`  |

```shell
$ bbt collection -c ./config/bbt-config.json
```

<br>
<br>
<br>

### translate

ä½¿ç”¨ç¿»è¯‘ API å¯¹`excel`æ–‡ä»¶è¿›è¡Œç¿»è¯‘
å¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„`excel`æ–‡ä»¶

| name         | shortName | type                  | description      | default    | required |
| ------------ | --------- | --------------------- | ---------------- | ---------- | -------- |
| --translator | -t        | `'google' \| 'deepl'` | ä½¿ç”¨å“ªä¸ªç¿»è¯‘ API | `'google'` | `false`  |
| --proxy      | -p        | `string`              | ä»£ç†åœ°å€         | `-`        | `false`  |
| --global     | -g        | `boolean`             | æ˜¯å¦è¿›è¡Œå…¨å±€ç¿»è¯‘ | `false`    | `false`  |

```shell
$ npx bbt translate
```

#### build

æ ¹æ®`excel`æ–‡ä»¶ç”Ÿæˆå¯¹åº”çš„èµ„æºæ–‡ä»¶

| name     | shortName | type     | description  | default           | required |
| -------- | --------- | -------- | ------------ | ----------------- | -------- |
| --config | -c        | `string` | é…ç½®æ–‡ä»¶åœ°å€ | `./bbt.config.js` | `false`  |

```shell
$ bbt build
```

<br>
<br>

<!-- ### update

å‡çº§ç‰ˆæœ¬

| name       | shortName | type       | description                                                                             | default | required |
| ---------- | --------- | ---------- | --------------------------------------------------------------------------------------- | ------- | -------- |
| --config   | -c        | `string[]` | è¦æ›´æ–°çš„ bbt.config.js æ–‡ä»¶è·¯å¾„ã€‚ä¸ºç©ºçš„è¯, ä¼šéå†æ‰§è¡Œç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è·å– bbt.config.js | `-`     | `false`  |
| --registry | -r        | `string`   | npm æºåœ°å€                                                                              | `-`     | `false`  |

### config

è®¾ç½®å…¨å±€é…ç½®

| name  | shortName | type     | description                                     | default | required |
| ----- | --------- | -------- | ----------------------------------------------- | ------- | -------- |
| --set | -s        | `string` | è®¾ç½®å¯¹åº”çš„é…ç½®å€¼ æ¯”å¦‚ `bbt config -s name=Nimi` | `-`     | `false`  |
| --get | -g        | `string` | è·å–å¯¹åº”çš„é…ç½®å€¼                                | `-`     | `false`  | -->

<br>
<br>
<br>
<br>

## é«˜çº§

### è‡ªå®šä¹‰è§£ææ–‡ä»¶

æœ‰æ—¶å€™å›½é™…åŒ–èµ„æºå¹¶ä¸æ˜¯ä½¿ç”¨`JSON`æ ¼å¼ï¼Œ å› æ­¤å¯ä»¥é€šè¿‡`plugins.parser`æ¥è‡ªå®šä¹‰æ–‡ä»¶çš„è§£ææ–¹å¼

#### æ–¹æ³•ç­¾å

```typescript
export interface FileParser<T = any> {
  parse(str: string): Record<string, T>;
  stringify(record: Record<string, T>): string;
}
```

#### example

`zh.tr`

```text
hello ä½ å¥½
world ä¸–ç•Œ
```

`bbt.config.js`

```js
module.exports = {
  // other
  plugins: {
    parser: {
      parse(content) {
        return Object.fromEntries(content.split(/\n/).map(str => str.split(/\s/)));
      },
      stringify(record) {
        return Object.entries(record)
          .map(arr => arr.join(' '))
          .join('\n');
      },
    },
  },
};
```

### è‡ªå®šä¹‰ç¿»è¯‘ API

#### å‡½æ•°ç­¾å

```typescript
/**
 *
 * @param record - éœ€è¦ç¿»è¯‘çš„æ•°æ®æº
 * @param target - ç¿»è¯‘çš„ç›®æ ‡è¯­è¨€
 * @param sourceLanguage - æ•°æ®æºåŸæœ¬çš„è¯­è¨€
 * @returns Observable<TranslatedList<string>> | Promise<TranslatedList<string>>;
 */
translator: (record: Record<string, string>, target: string, sourceLanguage: string) =>
  Observable<TranslatedList<string>> | Promise<TranslatedList<string>>;
```

#### example

```js
// bbt.config.js

module.exports = {
  // other
  plugins: {
    translator: (textMap, target, sourceLanguage) => {
      return Promise.resolve(
        Object.entries(textMap).map(([key, value]) => ({
          target,
          key,
          translatedText: `${value} - ${target}`,
        }))
      );
    },
  },
};
```

<!-- #### åˆè¡·

åœ¨å¤šè¯­è¨€çš„å¼€å‘ä¸­ï¼Œç»´æŠ¤å„ä¸ªè¯­è¨€ç¯å¢ƒä¸‹çš„ç¿»è¯‘å†…å®¹æ˜¯ä¸€ä»¶æ¯”è¾ƒç¹ççš„äº‹

- å¦‚ä½•çŸ¥é“æŒ‡å®š key æ˜¯å¦å­˜åœ¨è¯­è¨€ç¼ºå¤±çš„æƒ…å†µ
- key æ˜¯å¦ä¼šå­˜åœ¨å†²çª
- è¯­è¨€ç¯å¢ƒçš„ç»´æŠ¤
- ç¿»è¯‘å†…å®¹è¿ç§»é—®é¢˜
- å¦‚ä½•å°†åŸå§‹æ–‡æœ¬æå–å‡ºæ¥äº¤ç»™ç¿»è¯‘äººå‘˜ç¿»è¯‘
- ä½¿ç”¨å…è´¹çš„ç¿»è¯‘ API ç¿»è¯‘å†…å®¹
- å¤šäººå‘˜å¼€å‘å¯¼è‡´çš„å†²çª

`bbt-tools`å°±æ˜¯ç”¨æ¥å¤„ç†ä»¥ä¸Šé—®é¢˜çš„

- å¦‚ä½•çŸ¥é“æŒ‡å®š key æ˜¯å¦å­˜åœ¨è¯­è¨€ç¼ºå¤±çš„æƒ…å†µ
- å¦‚ä½•å°†åŸå§‹æ–‡æœ¬æå–å‡ºæ¥äº¤ç»™ç¿»è¯‘äººå‘˜ç¿»è¯‘

  `bbt-tools`ä¼šæ”¶é›†æŒ‡å®šç›®å½•ä¸‹ç¬¦åˆè§„åˆ™çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶æ ¹æ®æ–‡ä»¶ååˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å±äºå“ªç§è¯­è¨€ç¯å¢ƒä¸‹çš„å†…å®¹ï¼ˆ`xxx/zh.tr`å³ä¸º`zh`ä¸‹çš„å†…å®¹ï¼‰, æœ€åæ•´ç†åˆ°ä¸€ä¸ª`excel`æ–‡ä»¶é‡Œï¼Œ ç”¨æˆ·å¯ä»¥é€šè¿‡`excel`è‡ªå¸¦çš„ç­›é€‰å¯ä»¥å¾ˆç›´è§‚çš„çŸ¥é“å¯¹åº”çš„ç¼ºå¤±å†…å®¹ï¼Œä»¥åŠï¼Œå¦‚æœéœ€è¦äº¤ç»™ç¿»è¯‘äººå‘˜ç¿»è¯‘ï¼Œé‚£ä¹ˆä¹Ÿåªéœ€è¦å°†è¯¥è¡¨å‘é€ç»™å¯¹åº”çš„äººå‘˜ç¿»è¯‘å³å¯ï¼Œç¿»è¯‘å®Œä¹‹åï¼Œå¯ä»¥é€šè¿‡`bbt-tools build`å°†`excel`çš„å†…å®¹æ›´æ–°åˆ°å¯¹åº”çš„æ–‡ä»¶é‡Œ

- è¯­è¨€ç¯å¢ƒçš„ç»´æŠ¤

  å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰`zh`,`en`,`jp`ä¸‰ä¸ªè¯­è¨€ç¯å¢ƒï¼Œç°åœ¨éœ€è¦æ–°å¢ä¸€ä¸ª`th`çš„è¯­è¨€ç¯å¢ƒï¼Œå¯ä»¥ç›´æ¥åœ¨`bbt.config.js`çš„`langs`é‡Œæ·»åŠ `th`å³å¯ï¼Œ`bbt-tools`åœ¨è¿è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨çš„ç”Ÿæˆ`th`ç¯å¢ƒä¸‹çš„ç¿»è¯‘å†…å®¹ï¼ˆè™½ç„¶ä¼šç”Ÿæˆï¼Œä½†æ˜¯æ¯ä¸€ä¸ª key æ‰€å¯¹åº”çš„å†…å®¹ä¸º`''`ï¼‰;

- key æ˜¯å¦ä¼šå­˜åœ¨å†²çª

  æˆ‘ä»¬å¯ä»¥é€šè¿‡åå•†/å‘½åç©ºé—´/å±€éƒ¨ä½œç”¨åŸŸæ¥ä¸€å®šç¨‹åº¦ä¸Šçš„è§„é¿æ­¤é—®é¢˜ï¼Œä½†æ˜¯éš¾å…ä¼šå‡ºç°`key`é‡å¤çš„æƒ…å†µï¼Œ `bbt-tools`åœ¨è¿è¡Œæ—¶ä¼šæ£€æµ‹`key`æ˜¯å¦å­˜åœ¨é‡å¤çš„æƒ…å†µ

- ç¿»è¯‘å†…å®¹è¿ç§»é—®é¢˜

  é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬è¦ç§»åŠ¨ç¿»è¯‘å†…å®¹ï¼Œé‚£ä¹ˆéœ€è¦ä¿®æ”¹å¤šä¸ªæ–‡ä»¶ï¼Œ`bbt-tools`ä¼šåœ¨è¿è¡Œæ—¶æ£€æµ‹å¯¹åº”çš„`key`çš„æ–‡ä»¶è·¯å¾„è·Ÿä¹‹å‰çš„æ˜¯å¦ä¸€è‡´ï¼Œä¸ä¸€è‡´çš„è¯ï¼Œé‚£ä¹ˆä¼šæ›´æ–°å¯¹åº”çš„è·¯å¾„ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦æ›´æ”¹ä¸€ä¸ªæ–‡ä»¶å³å¯ã€‚

- ä½¿ç”¨å…è´¹çš„ç¿»è¯‘ API ç¿»è¯‘å†…å®¹

  å†…ç½®`google`ä»¥åŠ`DeepL`ç¿»è¯‘ API, å¯ä»¥ç›´æ¥å¼€ç®±å³ç”¨ï¼ˆè¯·è‡ªè¡Œè§£å†³è¿ä¸ä¸Š`google`æœåŠ¡å™¨çš„é—®é¢˜ï¼‰ï¼Œ ä¹Ÿå¯ä»¥è‡ªè¡Œæ‰©å±•ç¿»è¯‘æ¥å£ï¼Œä½¿ç”¨è‡ªå·±å–œæ¬¢çš„ç¿»è¯‘ API è¿›è¡Œç¿»è¯‘ï¼Œä¸éœ€è¦è€ƒè™‘å¦‚æœæ”¶é›†ä¿¡æ¯ã€è¿˜åŸç¿»è¯‘å†…å®¹çš„é—®é¢˜ï¼›

- å¤šäººå‘˜å¼€å‘å¯¼è‡´çš„å†²çª

  å¤šäººå‘˜åŒæ—¶å¤„ç†ä¸€ä¸ªæ–‡æœ¬çš„æ—¶å€™ï¼Œå› ä¸ºç¼–ç ä¹ æƒ¯ã€æ’å…¥/ä¿®æ”¹ä½ç½®ä¸ä¸€è‡´ï¼Œä¼šå¯¼è‡´`git`éš¾ä»¥å‡†ç¡®è¿½è¸ªæ¯ä¸€ä¸ª`key`çš„å˜æ›´è®°å½•ã€‚
  `bbt-tools`åœ¨ç”Ÿæˆæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šå¯¹`key`åšä¸€æ¬¡æ’åºï¼Œä»è€Œå¯ä»¥ä½¿å¾—`git`å¯ä»¥ç²¾å‡†çš„è¿½è¸ªæ¯ä¸€ä¸ª`key`çš„å˜åŒ–ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ›´åŠ è½»æ¾çš„å¤„ç†å†²çª

#### [è®¾è®¡](./docs/design.md)

#### [å¦‚ä½•ä½¿ç”¨](./docs/use.md) -->
